"use strict";(self.webpackChunkmilkdown=self.webpackChunkmilkdown||[]).push([[11],{11:(e,t,i)=>{i.d(t,{GN:()=>Re,Q3:()=>E,e7:()=>W,h1:()=>Be});var n=i(797),o=i(5145),s=i(5287),r=i(9681),a=i(2123),l=i(2845),c=i(9418),p=i(641),h=i(953),u=i(3751),d=i(4164),k=i(181),m=Object.defineProperty,v=Object.getOwnPropertySymbols,f=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,w=(e,t,i)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,b=(e,t)=>{for(var i in t||(t={}))f.call(t,i)&&w(e,i,t[i]);if(v)for(var i of v(t))y.call(t,i)&&w(e,i,t[i]);return e};function g(e,t){return Object.assign(e,{meta:b({package:"@milkdown/components"},t)}),e}var O=Object.defineProperty,M=Object.getOwnPropertySymbols,P=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,C=(e,t,i)=>t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,j=(e,t)=>{for(var i in t||(t={}))P.call(t,i)&&C(e,i,t[i]);if(M)for(var i of M(t))L.call(t,i)&&C(e,i,t[i]);return e};const x=(0,n.Qx)(j({},{mode:"preview"}),"linkTooltipStateCtx");g(x,{displayName:"State<link-tooltip>",group:"LinkTooltip"});const E=(0,n.Qx)(j({},{addLink:()=>{},editLink:()=>{},removeLink:()=>{}}),"linkTooltipAPICtx");g(x,{displayName:"API<link-tooltip>",group:"LinkTooltip"});const W=(0,n.Qx)(j({},{linkIcon:()=>"ðŸ”—",editButton:()=>"âœŽ",removeButton:()=>"âŒ«",confirmButton:()=>"Confirm âŽ",onCopyLink:()=>{},inputPlaceholder:"Paste link..."}),"linkTooltipConfigCtx");g(x,{displayName:"Config<link-tooltip>",group:"LinkTooltip"});const T=(0,o.y)("LINK_PREVIEW");g(T[0],{displayName:"PreviewTooltipSpec<link-tooltip>",group:"LinkTooltip"}),g(T[1],{displayName:"PreviewTooltipPlugin<link-tooltip>",group:"LinkTooltip"});const S=(0,o.y)("LINK_EDIT");function q({icon:e,class:t,onClick:i}){return(0,p.h)("span",{class:(0,d.A)("milkdown-icon",t),onPointerdown:i,ref:t=>{t&&e&&(t.innerHTML=c.A.sanitize(e.trim()))}})}g(S[0],{displayName:"EditTooltipSpec<link-tooltip>",group:"LinkTooltip"}),g(S[1],{displayName:"EditTooltipPlugin<link-tooltip>",group:"LinkTooltip"}),q.props={icon:{type:String,required:!1},class:{type:String,required:!1},onClick:{type:Function,required:!1}};const I=(0,p.pM)({props:{config:{type:Object,required:!0},src:{type:Object,required:!0},onConfirm:{type:Function,required:!0},onCancel:{type:Function,required:!0}},setup({config:e,src:t,onConfirm:i,onCancel:n}){const o=(0,h.KR)(t);(0,p.wB)(t,(e=>{o.value=e}));const s=()=>{i(o.value)},r=e=>{e.stopPropagation(),"Enter"===e.key&&(e.preventDefault(),s()),"Escape"===e.key&&(e.preventDefault(),n())};return()=>(0,p.h)("div",{class:"link-edit"},(0,p.h)("input",{class:"input-area",placeholder:e.value.inputPlaceholder,onKeydown:r,onInput:e=>{o.value=e.target.value},value:o.value}),o.value?(0,p.h)(q,{class:"button confirm",icon:e.value.confirmButton(),onClick:s}):null)}});var R,B,N,K,A,D,Y,F,Q,G=Object.defineProperty,_=Object.defineProperties,z=Object.getOwnPropertyDescriptors,H=Object.getOwnPropertySymbols,U=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable,X=e=>{throw TypeError(e)},J=(e,t,i)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Z=(e,t)=>{for(var i in t||(t={}))U.call(t,i)&&J(e,i,t[i]);if(H)for(var i of H(t))V.call(t,i)&&J(e,i,t[i]);return e},$=(e,t)=>_(e,z(t)),ee=(e,t,i)=>t.has(e)||X("Cannot "+i),te=(e,t,i)=>(ee(e,t,"read from private field"),i?i.call(e):t.get(e)),ie=(e,t,i)=>t.has(e)?X("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),ne=(e,t,i,n)=>(ee(e,t,"write to private field"),t.set(e,i),i);const oe={from:-1,to:-1,mark:null};class se{constructor(e,t){this.ctx=e,ie(this,R),ie(this,B),ie(this,N,Z({},oe)),ie(this,K),ie(this,A),ie(this,D,(0,h.KR)("")),ie(this,Y,(()=>{te(this,B).hide(),this.ctx.update(x.key,(e=>$(Z({},e),{mode:"preview"}))),ne(this,N,Z({},oe))})),ie(this,F,(e=>{const t=this.ctx.get(s.kY),{from:i,to:n,mark:o}=te(this,N),a=r.Yk.type(this.ctx),l=c.A.sanitize(e);if(o&&o.attrs.href===l)return void te(this,Y).call(this);const p=t.state.tr;o&&p.removeMark(i,n,o),p.addMark(i,n,a.create({href:l})),t.dispatch(p),te(this,Y).call(this)})),ie(this,Q,((e,t,i)=>{const n=this.ctx.get(W.key);te(this,A).value=n,te(this,D).value=e,this.ctx.update(x.key,(e=>$(Z({},e),{mode:"edit"})));const o=this.ctx.get(s.kY);o.dispatch(o.state.tr.setSelection(l.U3.create(o.state.doc,t,i))),te(this,B).show({getBoundingClientRect:()=>(0,a.MG)(o,t,i)}),requestAnimationFrame((()=>{var e;null==(e=te(this,R).querySelector("input"))||e.focus()}))})),this.update=e=>{const{state:t}=e,{selection:i}=t;if(!(i instanceof l.U3))return;const{from:n,to:o}=i;n===te(this,N).from&&o===te(this,N).to||te(this,Y).call(this)},this.destroy=()=>{te(this,K).unmount(),te(this,B).destroy(),te(this,R).remove()},this.addLink=(e,t)=>{ne(this,N,{from:e,to:t,mark:null}),te(this,Q).call(this,"",e,t)},this.editLink=(e,t,i)=>{ne(this,N,{from:t,to:i,mark:e}),te(this,Q).call(this,e.attrs.href,t,i)},this.removeLink=(e,t)=>{const i=this.ctx.get(s.kY),n=i.state.tr;n.removeMark(e,t,r.Yk.type(this.ctx)),i.dispatch(n),te(this,Y).call(this)},ne(this,A,(0,h.KR)(this.ctx.get(W.key)));const i=document.createElement("div");i.className="milkdown-link-edit";const n=(0,u.Ef)(I,{config:te(this,A),src:te(this,D),onConfirm:te(this,F),onCancel:te(this,Y)});n.mount(i),ne(this,K,n),ne(this,R,i),ne(this,B,new o.B({content:i,debounce:0,shouldShow:()=>!1})),te(this,B).onHide=()=>{requestAnimationFrame((()=>{t.dom.focus({preventScroll:!0})}))},te(this,B).update(t)}}R=new WeakMap,B=new WeakMap,N=new WeakMap,K=new WeakMap,A=new WeakMap,D=new WeakMap,Y=new WeakMap,F=new WeakMap,Q=new WeakMap;var re=Object.defineProperty,ae=Object.defineProperties,le=Object.getOwnPropertyDescriptors,ce=Object.getOwnPropertySymbols,pe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable,ue=(e,t,i)=>t in e?re(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,de=(e,t)=>{for(var i in t||(t={}))pe.call(t,i)&&ue(e,i,t[i]);if(ce)for(var i of ce(t))he.call(t,i)&&ue(e,i,t[i]);return e},ke=(e,t)=>ae(e,le(t));const me=(0,p.pM)({props:{config:{type:Object,required:!0},src:{type:Object,required:!0},onEdit:{type:Object,required:!0},onRemove:{type:Object,required:!0}},setup({config:e,src:t,onEdit:i,onRemove:n}){const o=e=>{e.preventDefault(),e.stopPropagation(),i.value()},s=e=>{e.preventDefault(),e.stopPropagation(),n.value()},r=i=>{i.preventDefault();const n=t.value;navigator.clipboard&&n&&navigator.clipboard.writeText(n).then((()=>{e.value.onCopyLink(n)})).catch((e=>console.error(e)))};return()=>(0,p.h)("div",{class:"link-preview",onPointerdown:r},(0,p.h)(q,{class:"link-icon",icon:e.value.linkIcon()}),(0,p.h)("a",{href:t.value,target:"_blank",class:"link-display"},t.value),(0,p.h)(q,{class:"button link-edit-button",icon:e.value.editButton(),onClick:o}),(0,p.h)(q,{class:"button link-remove-button",icon:e.value.removeButton(),onClick:s}))}});var ve,fe,ye,we,be,ge,Oe,Me,Pe,Le,Ce,je,xe,Ee=e=>{throw TypeError(e)},We=(e,t,i)=>t.has(e)||Ee("Cannot "+i),Te=(e,t,i)=>(We(e,t,"read from private field"),i?i.call(e):t.get(e)),Se=(e,t,i)=>t.has(e)?Ee("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),qe=(e,t,i,n)=>(We(e,t,"write to private field"),t.set(e,i),i);class Ie{constructor(e,t){this.ctx=e,Se(this,ve),Se(this,fe),Se(this,ye,this.ctx.use(x.key)),Se(this,we),Se(this,be,(0,h.KR)("")),Se(this,ge,(0,h.KR)((()=>{}))),Se(this,Oe,(0,h.KR)((()=>{}))),Se(this,Me),Se(this,Pe,!1),Se(this,Le,(({mode:e})=>{"edit"===e&&Te(this,xe).call(this)})),Se(this,Ce,(()=>{qe(this,Pe,!0)})),Se(this,je,(()=>{qe(this,Pe,!1)})),Se(this,xe,(()=>{Te(this,fe).hide(),Te(this,fe).element.removeEventListener("mouseenter",Te(this,Ce)),Te(this,fe).element.removeEventListener("mouseleave",Te(this,je))})),this.show=(e,t,i,n)=>{Te(this,we).value=this.ctx.get(W.key),Te(this,be).value=e.attrs.href,Te(this,ge).value=()=>{this.ctx.get(E.key).editLink(e,t,i)},Te(this,Oe).value=()=>{this.ctx.get(E.key).removeLink(t,i),Te(this,xe).call(this)},Te(this,fe).show({getBoundingClientRect:()=>n}),Te(this,fe).element.addEventListener("mouseenter",Te(this,Ce)),Te(this,fe).element.addEventListener("mouseleave",Te(this,je))},this.hide=()=>{Te(this,Pe)||Te(this,xe).call(this)},this.update=()=>{},this.destroy=()=>{Te(this,Me).unmount(),Te(this,ye).off(Te(this,Le)),Te(this,fe).destroy(),Te(this,ve).remove()},qe(this,we,(0,h.KR)(this.ctx.get(W.key))),qe(this,Me,(0,u.Ef)(me,{config:Te(this,we),src:Te(this,be),onEdit:Te(this,ge),onRemove:Te(this,Oe)})),qe(this,ve,document.createElement("div")),Te(this,ve).className="milkdown-link-preview",Te(this,Me).mount(Te(this,ve)),qe(this,fe,new o.B({debounce:0,content:Te(this,ve),shouldShow:()=>!1})),Te(this,fe).update(t),qe(this,ye,e.use(x.key)),Te(this,ye).on(Te(this,Le))}}function Re(e){(function(e){let t;const i=k(((i,n)=>{if(!t)return;if(!i.hasFocus())return;if("edit"===e.get(x.key).mode)return;const o=function(e,t,i){const n=t.posAtCoords({left:i.clientX,top:i.clientY});if(!n)return;const{pos:o}=n,s=t.state.doc.nodeAt(o);if(!s)return;const a=s.marks.find((t=>t.type===r.Yk.mark.type(e)));return a&&T.pluginKey()?{show:!0,pos:o,node:s,mark:a}:void 0}(e,i,n);if(o){const e=i.state.doc.resolve(o.pos),n=function(e,t,i,n,o){let s={start:-1,end:-1};return i.nodesBetween(n,o,((i,n)=>{if(s.start>-1)return!1;-1===s.start&&e.isInSet(i.marks)&&t===i&&(s={start:n,end:n+Math.max(i.textContent.length,1)})})),s}(o.mark,o.node,i.state.doc,e.before(),e.after()),s=n.start,r=n.end;t.show(o.mark,s,r,(0,a.MG)(i,s,r))}else t.hide()}),200);e.set(T.key,{props:{handleDOMEvents:{mousemove:i,mouseleave:()=>{setTimeout((()=>{null==t||t.hide()}),200)}}},view:i=>(t=new Ie(e,i),t)})})(e),function(e){let t;e.update(E.key,(e=>ke(de({},e),{addLink:(e,i)=>{null==t||t.addLink(e,i)},editLink:(e,i,n)=>{null==t||t.editLink(e,i,n)},removeLink:(e,i)=>{null==t||t.removeLink(e,i)}}))),e.set(S.key,{view:i=>(t=new se(e,i),t)})}(e)}ve=new WeakMap,fe=new WeakMap,ye=new WeakMap,we=new WeakMap,be=new WeakMap,ge=new WeakMap,Oe=new WeakMap,Me=new WeakMap,Pe=new WeakMap,Le=new WeakMap,Ce=new WeakMap,je=new WeakMap,xe=new WeakMap;const Be=[x,E,W,T,S].flat()}}]);