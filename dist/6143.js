"use strict";(self.webpackChunkmilkdown=self.webpackChunkmilkdown||[]).push([[6143],{32:(e,t,n)=>{n.d(t,{i:()=>o});const o='\n  <svg\n    xmlns="http://www.w3.org/2000/svg"\n    width="24"\n    height="24"\n    viewBox="0 0 24 24"\n  >\n    <g clip-path="url(#clip0_977_8075)">\n      <path\n        d="M19 5V19H5V5H19ZM19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM14.14 11.86L11.14 15.73L9 13.14L6 17H18L14.14 11.86Z"\n      />\n    </g>\n    <defs>\n      <clipPath id="clip0_977_8075">\n        <rect width="24" height="24" />\n      </clipPath>\n    </defs>\n  </svg>\n'},6143:(e,t,n)=>{n.d(t,{defineFeature:()=>L});var o=n(8998),l=n(797),a=n(9681),r=n(9418),i=n(641),c=n(953),u=n(3751),s=n(4164),d=n(4329),p=Object.defineProperty,v=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,h=(e,t,n)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,y=(e,t)=>{for(var n in t||(t={}))g.call(t,n)&&h(e,n,t[n]);if(v)for(var n of v(t))m.call(t,n)&&h(e,n,t[n]);return e};function f(e,t){return Object.assign(e,{meta:y({package:"@milkdown/components"},t)}),e}const b={imageIcon:()=>"ðŸŒŒ",uploadButton:()=>"Upload",confirmButton:()=>"âŽ",uploadPlaceholderText:"/Paste",onUpload:e=>Promise.resolve(URL.createObjectURL(e))},k=(0,l.Qx)(b,"inlineImageConfigCtx");function w({icon:e,class:t,onClick:n}){return(0,i.h)("span",{class:(0,s.A)("milkdown-icon",t),onPointerdown:n,ref:t=>{t&&e&&(t.innerHTML=r.A.sanitize(e.trim()))}})}f(k,{displayName:"Config<image-inline>",group:"ImageInline"}),w.props={icon:{type:String,required:!1},class:{type:String,required:!1},onClick:{type:Function,required:!1}};const O=(0,d.d_)("abcdefg",8),P=(0,i.pM)({props:{src:{type:Object,required:!0},selected:{type:Object,required:!0},readonly:{type:Object,required:!0},setLink:{type:Function,required:!0},imageIcon:{type:String,required:!1},uploadButton:{type:String,required:!1},confirmButton:{type:String,required:!1},uploadPlaceholderText:{type:String,required:!1},onUpload:{type:Function,required:!0}},setup({readonly:e,src:t,setLink:n,onUpload:o,imageIcon:l,uploadButton:a,confirmButton:r,uploadPlaceholderText:u,className:d}){var p,v;const g=(0,c.KR)(!1),m=(0,c.KR)(),h=(0,c.KR)(null!=(p=t.value)?p:""),y=(0,c.KR)(O()),f=(0,c.KR)(0!==(null==(v=t.value)?void 0:v.length)),b=e=>{const t=e.target.value;f.value=0!==t.length,h.value=t},k=e=>{var t,o;"Enter"===e.key&&n(null!=(o=null==(t=m.value)?void 0:t.value)?o:"")},P=e=>{var t;const l=null==(t=e.target.files)?void 0:t[0];l&&o(l).then((e=>{e&&(n(e),f.value=!0)})).catch((e=>{console.error("An error occurred while uploading image"),console.error(e)}))};return()=>(0,i.h)("div",{class:(0,s.A)("image-edit",d)},(0,i.h)(w,{icon:l,class:"image-icon"}),(0,i.h)("div",{class:(0,s.A)("link-importer",g.value&&"focus")},(0,i.h)("input",{ref:m,draggable:"true",onDragstart:e=>{e.preventDefault(),e.stopPropagation()},disabled:e.value,class:"link-input-area",value:h.value,onInput:b,onKeydown:k,onFocus:()=>g.value=!0,onBlur:()=>g.value=!1}),!f.value&&(0,i.h)("div",{class:"placeholder"},(0,i.h)("input",{disabled:e.value,class:"hidden",id:y.value,type:"file",accept:"image/*",onChange:P}),(0,i.h)("label",{class:"uploader",for:y.value},(0,i.h)(w,{icon:a})),(0,i.h)("span",{class:"text",onClick:()=>{var e;return null==(e=m.value)?void 0:e.focus()}},u))),h.value&&(0,i.h)("div",{class:"confirm",onClick:()=>{var e,t;n(null!=(t=null==(e=m.value)?void 0:e.value)?t:"")}},(0,i.h)(w,{icon:r})))}}),q=(0,i.pM)({props:{src:{type:Object,required:!0},alt:{type:Object,required:!0},title:{type:Object,required:!0},selected:{type:Object,required:!0},readonly:{type:Object,required:!0},setAttr:{type:Function,required:!0},config:{type:Object,required:!0}},setup(e){const{src:t,alt:n,title:o}=e;return()=>{var l;return(null==(l=t.value)?void 0:l.length)?(0,i.h)("img",{class:"image-inline",src:t.value,alt:n.value,title:o.value}):(0,i.h)(P,{src:e.src,selected:e.selected,readonly:e.readonly,setLink:t=>e.setAttr("src",t),imageIcon:e.config.imageIcon(),uploadButton:e.config.uploadButton(),confirmButton:e.config.confirmButton(),uploadPlaceholderText:e.config.uploadPlaceholderText,onUpload:e.config.onUpload,className:"empty-image-inline"})}}}),B=(0,l.m5)(a.Fi.node,(e=>(t,n,o)=>{const l=(0,c.KR)(t.attrs.src),a=(0,c.KR)(t.attrs.alt),s=(0,c.KR)(t.attrs.title),d=(0,c.KR)(!1),p=(0,c.KR)(!n.editable),v=e.get(k.key),g=(0,u.Ef)(q,{src:l,alt:a,title:s,selected:d,readonly:p,setAttr:(e,t)=>{const l=o();null!=l&&n.dispatch(n.state.tr.setNodeAttribute(l,e,"src"===e?r.A.sanitize(t):t))},config:v}),m=document.createElement("span");m.className="milkdown-image-inline",g.mount(m);const h=(0,i.nT)((()=>{d.value?m.classList.add("selected"):m.classList.remove("selected")})),y=v.proxyDomURL,f=e=>{if(y){const t=y(e.attrs.src);"string"==typeof t?l.value=t:t.then((e=>{l.value=e})).catch(console.error)}else l.value=e.attrs.src;a.value=e.attrs.alt,s.value=e.attrs.title};return f(t),{dom:m,update:e=>e.type===t.type&&(f(e),!0),stopEvent:e=>e.target instanceof HTMLInputElement,selectNode:()=>{d.value=!0},deselectNode:()=>{d.value=!1},destroy:()=>{h(),g.unmount(),m.remove()}}}));f(B,{displayName:"NodeView<image-inline>",group:"ImageInline"});const j=[k,B];var I=n(8925),x=n(32);const L=(e,t)=>{e.config((e=>{e.update(k.key,(e=>{var n,o,l,a,r,i;return{uploadButton:null!=(n=null==t?void 0:t.inlineUploadButton)?n:()=>"Upload",imageIcon:null!=(o=null==t?void 0:t.inlineImageIcon)?o:()=>x.i,confirmButton:null!=(l=null==t?void 0:t.inlineConfirmButton)?l:()=>I.c,uploadPlaceholderText:null!=(a=null==t?void 0:t.inlineUploadPlaceholderText)?a:"or paste link",onUpload:null!=(i=null!=(r=null==t?void 0:t.inlineOnUpload)?r:null==t?void 0:t.onUpload)?i:e.onUpload,proxyDomURL:null==t?void 0:t.proxyDomURL}})),e.update(o.p0.key,(e=>{var n,o,l,a,r,i,c,u;return{uploadButton:null!=(n=null==t?void 0:t.blockUploadButton)?n:()=>"Upload file",imageIcon:null!=(o=null==t?void 0:t.blockImageIcon)?o:()=>x.i,captionIcon:null!=(l=null==t?void 0:t.blockCaptionIcon)?l:()=>'\n  <svg\n    xmlns="http://www.w3.org/2000/svg"\n    width="32"\n    height="32"\n    viewBox="0 0 24 24"\n  >\n    <path\n      fill="currentColor"\n      d="M9 22a1 1 0 0 1-1-1v-3H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-6.1l-3.7 3.71c-.2.19-.45.29-.7.29zm1-6v3.08L13.08 16H20V4H4v12z"\n    />\n  </svg>\n',confirmButton:null!=(a=null==t?void 0:t.blockConfirmButton)?a:()=>"Confirm",captionPlaceholderText:null!=(r=null==t?void 0:t.blockCaptionPlaceholderText)?r:"Write Image Caption",uploadPlaceholderText:null!=(i=null==t?void 0:t.blockUploadPlaceholderText)?i:"or paste link",onUpload:null!=(u=null!=(c=null==t?void 0:t.blockOnUpload)?c:null==t?void 0:t.onUpload)?u:e.onUpload,proxyDomURL:null==t?void 0:t.proxyDomURL}}))})).use(o.iH).use(j)}},8925:(e,t,n)=>{n.d(t,{c:()=>o});const o='\n  <svg\n    xmlns="http://www.w3.org/2000/svg"\n    width="24"\n    height="24"\n    viewBox="0 0 24 24"\n    fill="none"\n  >\n    <g clip-path="url(#clip0_1013_1606)">\n      <path\n        d="M9.00012 16.1998L5.50012 12.6998C5.11012 12.3098 4.49012 12.3098 4.10012 12.6998C3.71012 13.0898 3.71012 13.7098 4.10012 14.0998L8.29012 18.2898C8.68012 18.6798 9.31012 18.6798 9.70012 18.2898L20.3001 7.69982C20.6901 7.30982 20.6901 6.68982 20.3001 6.29982C19.9101 5.90982 19.2901 5.90982 18.9001 6.29982L9.00012 16.1998Z"\n        fill="#817567"\n      />\n    </g>\n    <defs>\n      <clipPath id="clip0_1013_1606">\n        <rect width="24" height="24" />\n      </clipPath>\n    </defs>\n  </svg>\n'},8998:(e,t,n)=>{n.d(t,{YD:()=>N,iH:()=>H,p0:()=>k});var o=n(797),l=n(7970),a=n(9033),r=n(9418),i=n(641),c=n(953),u=n(3751),s=n(4164),d=n(4329),p=Object.defineProperty,v=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,h=(e,t,n)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,y=(e,t)=>{for(var n in t||(t={}))g.call(t,n)&&h(e,n,t[n]);if(v)for(var n of v(t))m.call(t,n)&&h(e,n,t[n]);return e};function f(e,t){return Object.assign(e,{meta:y({package:"@milkdown/components"},t)}),e}const b={imageIcon:()=>"ðŸŒŒ",captionIcon:()=>"ðŸ’¬",uploadButton:()=>"Upload file",confirmButton:()=>"Confirm âŽ",uploadPlaceholderText:"or paste the image link ...",captionPlaceholderText:"Image caption",onUpload:e=>Promise.resolve(URL.createObjectURL(e))},k=(0,o.Qx)(b,"imageBlockConfigCtx");function w(e){return(0,l.YR)(e,"paragraph",((e,t,n)=>{var o,l;if(1!==(null==(o=e.children)?void 0:o.length))return;const a=null==(l=e.children)?void 0:l[0];if(!a||"image"!==a.type)return;const{url:r,alt:i,title:c}=a,u={type:"image-block",url:r,alt:i,title:c};n.children.splice(t,1,u)}))}f(k,{displayName:"Config<image-block>",group:"ImageBlock"});const O=(0,o.lz)("remark-image-block",(()=>()=>w));f(O.plugin,{displayName:"Remark<remarkImageBlock>",group:"ImageBlock"}),f(O.options,{displayName:"RemarkConfig<remarkImageBlock>",group:"ImageBlock"});var P=Object.defineProperty,q=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable,I=(e,t,n)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,x=(e,t)=>{for(var n in t||(t={}))B.call(t,n)&&I(e,n,t[n]);if(q)for(var n of q(t))j.call(t,n)&&I(e,n,t[n]);return e};const L="image-block",N=(0,o.Yh)("image-block",(()=>({inline:!1,group:"block",selectable:!0,draggable:!0,isolating:!0,marks:"",atom:!0,priority:100,attrs:{src:{default:"",validate:"string"},caption:{default:"",validate:"string"},ratio:{default:1,validate:"number"}},parseDOM:[{tag:`img[data-type="${L}"]`,getAttrs:e=>{var t;if(!(e instanceof HTMLElement))throw(0,a.Ik)(e);return{src:e.getAttribute("src")||"",caption:e.getAttribute("caption")||"",ratio:Number(null!=(t=e.getAttribute("ratio"))?t:1)}}}],toDOM:e=>["img",x({"data-type":L},e.attrs)],parseMarkdown:{match:({type:e})=>"image-block"===e,runner:(e,t,n)=>{const o=t.url,l=t.title;let a=Number(t.alt||1);(Number.isNaN(a)||0===a)&&(a=1),e.addNode(n,{src:o,caption:l,ratio:a})}},toMarkdown:{match:e=>"image-block"===e.type.name,runner:(e,t)=>{e.openNode("paragraph"),e.addNode("image",void 0,void 0,{title:t.attrs.caption,url:t.attrs.src,alt:`${Number.parseFloat(t.attrs.ratio).toFixed(2)}`}),e.closeNode()}}})));function R({icon:e,class:t,onClick:n}){return(0,i.h)("span",{class:(0,s.A)("milkdown-icon",t),onPointerdown:n,ref:t=>{t&&e&&(t.innerHTML=r.A.sanitize(e.trim()))}})}f(N.node,{displayName:"NodeSchema<image-block>",group:"ImageBlock"}),R.props={icon:{type:String,required:!1},class:{type:String,required:!1},onClick:{type:Function,required:!1}};const C=(0,d.d_)("abcdefg",8),U=(0,i.pM)({props:{src:{type:Object,required:!0},selected:{type:Object,required:!0},readonly:{type:Object,required:!0},setLink:{type:Function,required:!0},imageIcon:{type:String,required:!1},uploadButton:{type:String,required:!1},confirmButton:{type:String,required:!1},uploadPlaceholderText:{type:String,required:!1},onUpload:{type:Function,required:!0}},setup({readonly:e,src:t,setLink:n,onUpload:o,imageIcon:l,uploadButton:a,confirmButton:r,uploadPlaceholderText:u,className:d}){var p,v;const g=(0,c.KR)(!1),m=(0,c.KR)(),h=(0,c.KR)(null!=(p=t.value)?p:""),y=(0,c.KR)(C()),f=(0,c.KR)(0!==(null==(v=t.value)?void 0:v.length)),b=e=>{const t=e.target.value;f.value=0!==t.length,h.value=t},k=e=>{var t,o;"Enter"===e.key&&n(null!=(o=null==(t=m.value)?void 0:t.value)?o:"")},w=e=>{var t;const l=null==(t=e.target.files)?void 0:t[0];l&&o(l).then((e=>{e&&(n(e),f.value=!0)})).catch((e=>{console.error("An error occurred while uploading image"),console.error(e)}))};return()=>(0,i.h)("div",{class:(0,s.A)("image-edit",d)},(0,i.h)(R,{icon:l,class:"image-icon"}),(0,i.h)("div",{class:(0,s.A)("link-importer",g.value&&"focus")},(0,i.h)("input",{ref:m,draggable:"true",onDragstart:e=>{e.preventDefault(),e.stopPropagation()},disabled:e.value,class:"link-input-area",value:h.value,onInput:b,onKeydown:k,onFocus:()=>g.value=!0,onBlur:()=>g.value=!1}),!f.value&&(0,i.h)("div",{class:"placeholder"},(0,i.h)("input",{disabled:e.value,class:"hidden",id:y.value,type:"file",accept:"image/*",onChange:w}),(0,i.h)("label",{class:"uploader",for:y.value},(0,i.h)(R,{icon:a})),(0,i.h)("span",{class:"text",onClick:()=>{var e;return null==(e=m.value)?void 0:e.focus()}},u))),h.value&&(0,i.h)("div",{class:"confirm",onClick:()=>{var e,t;n(null!=(t=null==(e=m.value)?void 0:e.value)?t:"")}},(0,i.h)(R,{icon:r})))}}),T=(0,i.pM)({props:{src:{type:Object,required:!0},caption:{type:Object,required:!0},ratio:{type:Object,required:!0},selected:{type:Object,required:!0},readonly:{type:Object,required:!0},setAttr:{type:Function,required:!0},config:{type:Object,required:!0}},setup({src:e,caption:t,ratio:n,readonly:o,setAttr:l,config:a}){var r;const u=(0,c.KR)(),s=(0,c.KR)(),d=(0,c.KR)(Boolean(null==(r=t.value)?void 0:r.length)),p=(0,c.KR)(0),v=()=>{var e;const t=u.value;if(!t)return;const o=t.closest(".milkdown-image-block");if(!o)return;const l=o.getBoundingClientRect().width;if(!l)return;const a=t.height,r=t.width,i=r<l?a:l*(a/r),c=(i*(null!=(e=n.value)?e:1)).toFixed(2);t.dataset.origin=i.toFixed(2),t.dataset.height=c,t.style.height=`${c}px`},g=e=>{e.preventDefault(),e.stopPropagation(),o.value||(d.value=!d.value)},m=e=>{const t=e.target.value;p.value&&window.clearTimeout(p.value),p.value=window.setTimeout((()=>{l("caption",t)}),1e3)},h=e=>{const t=e.target.value;p.value&&(window.clearTimeout(p.value),p.value=0),l("caption",t)},y=e=>{e.preventDefault();const t=u.value;if(!t)return;const n=t.getBoundingClientRect().top,o=e.clientY-n,l=Number(o<100?100:o).toFixed(2);t.dataset.height=l,t.style.height=`${l}px`},f=()=>{window.removeEventListener("pointermove",y),window.removeEventListener("pointerup",f);const e=u.value;if(!e)return;const t=Number(e.dataset.origin),n=Number(e.dataset.height),o=Number.parseFloat(Number(n/t).toFixed(2));Number.isNaN(o)||l("ratio",o)},b=e=>{o.value||(e.preventDefault(),e.stopPropagation(),window.addEventListener("pointermove",y),window.addEventListener("pointerup",f))};return()=>(0,i.h)(i.FK,null,(0,i.h)("div",{class:"image-wrapper"},(0,i.h)("div",{class:"operation"},(0,i.h)("div",{class:"operation-item",onPointerdown:g},(0,i.h)(R,{icon:a.captionIcon()}))),(0,i.h)("img",{ref:u,"data-type":L,onLoad:v,src:e.value,alt:t.value}),(0,i.h)("div",{ref:s,class:"image-resize-handle",onPointerdown:b})),d.value&&(0,i.h)("input",{draggable:"true",onDragstart:e=>{e.preventDefault(),e.stopPropagation()},class:"caption-input",placeholder:null==a?void 0:a.captionPlaceholderText,onInput:m,onBlur:h,value:t.value}))}});var K=Object.defineProperty,A=Object.getOwnPropertySymbols,F=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable,M=(e,t,n)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;const D=(0,i.pM)({props:{src:{type:Object,required:!0},caption:{type:Object,required:!0},ratio:{type:Object,required:!0},selected:{type:Object,required:!0},readonly:{type:Object,required:!0},setAttr:{type:Function,required:!0},config:{type:Object,required:!0}},setup(e){const{src:t}=e;return()=>{var n;return(null==(n=t.value)?void 0:n.length)?(0,i.h)(T,((e,t)=>{for(var n in t||(t={}))F.call(t,n)&&M(e,n,t[n]);if(A)for(var n of A(t))E.call(t,n)&&M(e,n,t[n]);return e})({},e)):(0,i.h)(U,{src:e.src,selected:e.selected,readonly:e.readonly,setLink:t=>e.setAttr("src",t),imageIcon:e.config.imageIcon(),uploadButton:e.config.uploadButton(),confirmButton:e.config.confirmButton(),uploadPlaceholderText:e.config.uploadPlaceholderText,onUpload:e.config.onUpload})}}}),S=(0,o.m5)(N.node,(e=>(t,n,o)=>{const l=(0,c.KR)(t.attrs.src),a=(0,c.KR)(t.attrs.caption),s=(0,c.KR)(t.attrs.ratio),d=(0,c.KR)(!1),p=(0,c.KR)(!n.editable),v=e.get(k.key),g=(0,u.Ef)(D,{src:l,caption:a,ratio:s,selected:d,readonly:p,setAttr:(e,t)=>{const l=o();null!=l&&n.dispatch(n.state.tr.setNodeAttribute(l,e,"src"===e?r.A.sanitize(t):t))},config:v}),m=document.createElement("div");m.className="milkdown-image-block",g.mount(m);const h=(0,i.nT)((()=>{d.value?m.classList.add("selected"):m.classList.remove("selected")})),y=v.proxyDomURL,f=e=>{if(y){const t=y(e.attrs.src);"string"==typeof t?l.value=t:t.then((e=>{l.value=e})).catch(console.error)}else l.value=e.attrs.src;s.value=e.attrs.ratio,a.value=e.attrs.caption,p.value=!n.editable};return f(t),{dom:m,update:e=>e.type===t.type&&(f(e),!0),stopEvent:e=>e.target instanceof HTMLInputElement,selectNode:()=>{d.value=!0},deselectNode:()=>{d.value=!1},destroy:()=>{h(),g.unmount(),m.remove()}}}));f(S,{displayName:"NodeView<image-block>",group:"ImageBlock"});const H=[O,N,S,k].flat()}}]);